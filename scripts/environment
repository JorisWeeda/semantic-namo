#!/usr/bin/env python3

import hydra
import rospy

from environment import SimulateWorld, PhysicalWorld


if __name__ == "__main__":
    rospy.init_node('environment', anonymous=True)
    
    run_frequency = rospy.get_param('~run_frequency')
    is_simulation = rospy.get_param('~is_simulation')
    config = rospy.get_param('~config')
    layout = rospy.get_param('~layout')

    hydra.initialize(config_path="../config", version_base=None)
    hydra_config = hydra.compose(config)

    if is_simulation:
        rospy.loginfo(f'Running simulate world with configuration: {config} and world: {layout}')
        world = SimulateWorld.build(hydra_config, layout)
    else:
        rospy.loginfo(f'Running physical world with configuration: {config} and world: {layout}')
        world = PhysicalWorld.build(hydra_config, layout)

    rate = rospy.Rate(run_frequency)
    while not rospy.is_shutdown():
        world.run()

        rate.sleep()

    if is_simulation:
        world.destroy()
